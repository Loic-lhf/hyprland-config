#!/bin/bash

# Check if the user provided an argument
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <path_to_image>"
    exit 1
fi

IMAGE="$1"
config="$HOME/.config/hypr/hyprpaper.conf"

# Send notification to the user
notify-send "Changing theme" "Applying new wallpaper and updating colors, please wait until confirmation..."

# Set wallpaper
killall hyprpaper 2>/dev/null

cat > "$config" <<EOF
preload = $HOME/Pictures/Wallpapers/$IMAGE
wallpaper = ,$HOME/Pictures/Wallpapers/$IMAGE
\$lockimage = $HOME/Pictures/Wallpapers/$IMAGE
EOF

hyprpaper &

# create rofi thumbnail
python ~/Pictures/Wallpapers-for-rofi/create_thumbnail.py $IMAGE

# Generate pywal colors
wal -i "$IMAGE" -n -s -t -e

# Update pywalfox
pywalfox update &

# Refresh waybar
pkill waybar
waybar > /dev/null 2>&1 &

# Refresh swaync
pkill swaync
swaync > /dev/null 2>&1 &

notify-send "Theme applied" "Wallpaper and theme updated successfully"
